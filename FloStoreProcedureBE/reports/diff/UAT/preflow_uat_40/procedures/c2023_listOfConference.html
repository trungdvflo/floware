<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>diff</title>
<meta name="Generator" content="Vim/9.0">
<meta name="plugin-version" content="vim9.0_v2">
<meta name="settings" content="whole_filler,use_css,no_foldcolumn,prevent_copy=,use_input_for_pc=none">
<meta name="colorscheme" content="none">
<style>
<!--
pre { font-family: monospace; color: #000000; background-color: #ffffff; }
body { font-family: monospace; color: #000000; background-color: #ffffff; }
* { font-size: 1em; }
.Folded { color: #0000c0; background-color: #a8a8a8; padding-bottom: 1px; }
.DiffText { background-color: #ff6060; padding-bottom: 1px; font-weight: bold; }
.DiffAdd { background-color: #5fd7ff; padding-bottom: 1px; }
.DiffChange { background-color: #ffd7ff; padding-bottom: 1px; }
.DiffDelete { color: #8080ff; background-color: #afffff; padding-bottom: 1px; }
-->
<!--
table { table-layout: fixed; }
html, body, table, tbody { width: 100%; margin: 0; padding: 0; }
table, td, th { border: 1px solid; }
td { vertical-align: top; }
th, td { width: 50.0%; }
td div { overflow: auto; }
-->
</style>
</head>
<body>
<table id='vimCodeElement'>
<tr>
<th>db/DEV/preflow_40/procedures/c2023_listOfConference.sql</th>
<th>db/UAT/preflow_uat_40/procedures/c2023_listOfConference.sql</th>
</tr><tr>
<td><div>
<pre>
<span class="Folded">+-- 58 lines: CREATE PROCEDURE `c2023_listOfConference`(pvKeyword         TEXT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci</span>
                                AND ch1.member_id = ch.member_id
                              )
                          ) ch ON (cm.id = ch.member_id AND cm.user_id = ch.user_id)
LEFT JOIN linked_collection_object lco ON (cc.uid = lco.object_uid
                                           AND cm.user_id = lco.user_id
                                           AND lco.object_type = 'CONFERENCING'
<span class="DiffChange">                                           AND (pvColIds IS NULL OR ifnull(lco.collection_id, 0) &gt; 0)</span>
<span class="DiffAdd">                                           AND ifnull(lco.is_trashed, 0) = 0</span><span class="DiffAdd">    </span>
<span class="DiffAdd">                                           )</span><span class="DiffAdd">                                    </span>
    WHERE cm.user_id = pnUserId
      AND (cm.revoke_time = 0 -- NOT revoked
           OR (cm.revoke_time &gt; 0 AND cm.user_id = pnUserId)) -- revoked but me
      AND (cm1.revoke_time = 0 -- NOT revoked
           OR (cm1.revoke_time &gt; 0 AND cm1.user_id = pnUserId)) -- revoked but me
      AND cm.updated_date  &lt;  IF(ifnull(pnModifiedLT, 0) &gt; 0, pnModifiedLT, unix_timestamp() + 1)
      AND cm.updated_date  &gt;= IF(ifnull(pnModifiedGTE, 0) &gt; 0, pnModifiedGTE, 0)
      AND cm.id            &gt;  IF(ifnull(pnMinId, 0) &gt; 0, pnMinId, 0)
      AND (pnVip IS NULL OR cm.vip = pnVip)
      AND IF(pvIDs IS NOT NULL, FIND_IN_SET(cm.id, pvIDs), 1)
      AND IF(pvChannelIDs IS NOT NULL, FIND_IN_SET(cc.id, pvChannelIDs), 1)
      AND IF(pvColIds IS NOT NULL, FIND_IN_SET(lco.collection_id, pvColIds), 1)
<span class="DiffDelete">--------------------------------------------------------------------------------</span>
      -- value = 1 &gt;&gt; search BY channel name (keyword=channel name)
      AND IF(nFilterType = 1, COALESCE(cm.title, cc.title, '') RLIKE vKeyword1, 1)
      -- value = 2 &gt;&gt; search BY participant
      AND IF(nFilterType &lt;&gt; 2, 1, EXISTS (
            SELECT 1
              FROM conference_member cm2
<span class="Folded">+-- 91 lines: WHERE cm2.channel_id = cc.id--------------------------------------</span>
</pre>
</div></td>
<td><div>
<pre>
<span class="Folded">+-- 58 lines: CREATE PROCEDURE `c2023_listOfConference`(pvKeyword         TEXT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci</span>
                                AND ch1.member_id = ch.member_id
                              )
                          ) ch ON (cm.id = ch.member_id AND cm.user_id = ch.user_id)
LEFT JOIN linked_collection_object lco ON (cc.uid = lco.object_uid
                                           AND cm.user_id = lco.user_id
                                           AND lco.object_type = 'CONFERENCING'
<span class="DiffChange">                                           AND (pvColIds IS NULL OR ifnull(lco.collection_id, 0) &gt; 0)</span><span class="DiffText">)</span>
<span class="DiffDelete">--------------------------------------------------------------------------------</span>
<span class="DiffDelete">--------------------------------------------------------------------------------</span>
    WHERE cm.user_id = pnUserId
      AND (cm.revoke_time = 0 -- NOT revoked
           OR (cm.revoke_time &gt; 0 AND cm.user_id = pnUserId)) -- revoked but me
      AND (cm1.revoke_time = 0 -- NOT revoked
           OR (cm1.revoke_time &gt; 0 AND cm1.user_id = pnUserId)) -- revoked but me
      AND cm.updated_date  &lt;  IF(ifnull(pnModifiedLT, 0) &gt; 0, pnModifiedLT, unix_timestamp() + 1)
      AND cm.updated_date  &gt;= IF(ifnull(pnModifiedGTE, 0) &gt; 0, pnModifiedGTE, 0)
      AND cm.id            &gt;  IF(ifnull(pnMinId, 0) &gt; 0, pnMinId, 0)
      AND (pnVip IS NULL OR cm.vip = pnVip)
      AND IF(pvIDs IS NOT NULL, FIND_IN_SET(cm.id, pvIDs), 1)
      AND IF(pvChannelIDs IS NOT NULL, FIND_IN_SET(cc.id, pvChannelIDs), 1)
      AND IF(pvColIds IS NOT NULL, FIND_IN_SET(lco.collection_id, pvColIds), 1)
<span class="DiffAdd">      AND ifnull(lco.is_trashed, 0) = 0</span><span class="DiffAdd">                                         </span>
      -- value = 1 &gt;&gt; search BY channel name (keyword=channel name)
      AND IF(nFilterType = 1, COALESCE(cm.title, cc.title, '') RLIKE vKeyword1, 1)
      -- value = 2 &gt;&gt; search BY participant
      AND IF(nFilterType &lt;&gt; 2, 1, EXISTS (
            SELECT 1
              FROM conference_member cm2
<span class="Folded">+-- 91 lines: WHERE cm2.channel_id = cc.id--------------------------------------</span>
</pre>
</div></td>
</tr>
</table>
</body>
</html>
<!-- vim: set foldmethod=manual : -->

